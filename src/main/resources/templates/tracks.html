<!DOCTYPE html>
<html lang="en">
<head th:insert="~{fragment::head}"></head>
<head>
    <title th:text="${@environment.getProperty('spring.application.name')} + ' : Tracks'">Serial port server</title>
    <style>
        .canvas-container {
            position: relative;
            width: 4000px; /* Adjust as needed */ /* ----- width: 1100px; / JW4000 / JW2000 */
            /*width: 1400px; !* Adjust as needed *!*/
            height: 6000px; /* Adjust as needed */ /* ----- height: 2000px; /JW6000 /JW3000 */
            /*height: 2100px; !* Adjust as needed *!*/
            border: 1px solid #555151;
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 4000px;
            height: 6000px;
        }

        #backgroundCanvas {
            z-index: 0;
        }

        #myCanvas {
            z-index: 1;
            pointer-events: none; /* To make sure the background canvas can still receive events */
        }
    </style>
</head>
<body>
<header th:replace="~{fragment::header}"></header>
<div>
    <form method="post" action="#" th:action="@{/tracks}" th:object="${checkBoxOption}" id="trackForm">
        <div class="container text-center p-2 justify-content-center mx-auto mb-3 mt-2">
            <div class="form-check form-check-inline mx-3">
                <input class="form-check-input" field="*{warta}" type="checkbox" name="warta" id="warta"
                       th:checked="${checkBoxOption?.warta == true}"/>
                <label class="form-check-label" for="warta">Warta</label>
            </div>
            <div class="form-check form-check-inline mx-3">
                <input class="form-check-input" field="*{bluelady}" type="checkbox" name="bluelady" id="bluelady"
                       th:checked="${checkBoxOption?.bluelady == true}"/>
                <label class="form-check-label" for="bluelady">Blue Lady</label>
            </div>
            <div class="form-check form-check-inline mx-3">
                <input class="form-check-input" field="*{cherrylady}" type="checkbox" name="cherrylady" id="cherrylady"
                       th:checked="${checkBoxOption?.cherrylady == true}"/>
                <label class="form-check-label" for="cherrylady">Cherry Lady</label>
            </div>
            <div class="form-check form-check-inline mx-3">
                <input class="form-check-input" field="*{kolobrzeg}" type="checkbox" name="kolobrzeg" id="kolobrzeg"
                       th:checked="${checkBoxOption?.kolobrzeg == true}"/>
                <label class="form-check-label" for="kolobrzeg">Ko≈Çobrzeg</label>
            </div>
            <div class="form-check form-check-inline mx-3">
                <input class="form-check-input" field="*{dorchesterlady}" type="checkbox" name="dorchesterlady"
                       id="dorchesterlady" th:checked="${checkBoxOption?.dorchesterlady == true}"/>
                <label class="form-check-label" for="dorchesterlady">Dorchester Lady</label>
            </div>
            <div class="form-check form-check-inline mx-3">
                <input class="form-check-input" field="*{ladymarie}" type="checkbox" name="ladymarie" id="ladymarie"
                       th:checked="${checkBoxOption?.ladymarie == true}"/>
                <label class="form-check-label" for="ladymarie">Lady Marie</label>
            </div>
        </div>
        <div class="container justify-content-center text-center py-2 my-2">
            <button type="submit" class="btn btn-primary mx-3">Submit</button>
            <button type="reset" class="btn btn-secondary mx-3">Reset</button>
        </div>
    </form>
    <div class="canvas-container">
        <div>
            <canvas id="myCanvas" width="4000" height="6000" style="border:1px solid #000000;"></canvas>
            <img id="backgroundCanvas" th:src="@{/img/MapaSilm_2666x4000.jpg}" src="/static/img/MapaSilm_2666x4000.jpg"
                 width="2666" height="4000" alt="Silm Lake Chart should be here">
        </div>
    </div>
</div>
<footer th:replace="~{fragment::footer}"></footer>
<script type="text/javascript" th:src="@{/js/common-draw-ship.js}"></script>
<script type="text/javascript" th:src="@{/js/common/enums.js}"></script>
<script th:inline="javascript">

    let mapItems = /*[[${trackMap}]]*/ null;
    console.log(mapItems);

    // Loop through the map and log both keys and values
    for (let key in mapItems) {
        if (mapItems.hasOwnProperty(key)) {
            let values = mapItems[key]; // Access the values (arrays in this case)
            const keyNumber = Number(key);
            console.log("Key:", keyNumber); // Log the key
            console.log("Values:", values); // Log the values

            let points = [];
            let scaledPoints = [];

            items = values;
            console.log("items: ", items);

            for (let i = 0; i < items.length; i++) {
                let item = items[i];
                console.log(item);
                const point = {x: item.modelTrack.positionX, y: item.modelTrack.positionX};
                console.log(point);
                points.push(point);
            }
            // Get the canvas element and its context
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');

            // points.push({x: 0, y: 0});
            // points.push({x: 110, y: 120});
            console.log(points);
            for (let i = 0; i < points.length; i++) {
                scaledPoints[i] = getScaledPoints(points[i].x, points[i].y)
            }
            console.log(scaledPoints);

            points = scaledPoints;
            console.log(points);

            // Check if there are enough points to draw a line
            if (points.length > 1) {
                ctx.beginPath();
                // Move to the first point
                ctx.moveTo(points[0].x, points[0].y);
                console.log(points[0].x, points[0].y);

                // Draw lines between the points
                for (let i = 1; i < points.length; i++) {
                    console.log(points[i].x, points[i].y);
                    ctx.lineTo(points[i].x, points[i].y);
                }

                // Set stroke style and draw the line
                const colorFromId = ModelsOfShips.getColorFromId(keyNumber);
                console.log(colorFromId);
                ctx.strokeStyle = colorFromId == null ? 'black' : colorFromId;
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }
    }
</script>
</body>
</html>